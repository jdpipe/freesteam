%define pyver %(python -c 'import sys ; print sys.version[:3]')

Name:		freesteam
Summary:	Steam tables library (implements IAPWS-IF97 and IAPWS-95 correlations)
Version:	@VERSION@

# Use release 0.* so that other users can do patch releases with a higher number
# and still have the update occur automatically.
Release:	@RELEASE@

License:	GPL
Group:		Applications/Engineering
Source:		%{name}-%{version}.tar.bz2
URL:		http://pye.dyndns.org/freesteam/

Prefix:		%{_prefix}
Packager:	John Pye
Vendor:		University of New South Wales
BuildRoot:	%{_tmppath}/%{name}-%{version}-root

BuildRequires: python >= 2.4, python-devel
BuildRequires: scons >= 0.96.1
BuildRequires: swig >= 1.3.24
BuildRequires: ascend >= 0.9.5.100

Requires: python >= 2.4

%description
freesteam is an open source implementation of international-standard steam tables 
from the International Association for the Properties of Water and Steam (IAPWS). 
See http://freesteam.sf.net for more information.

%prep
%setup -q 

%build
rm -rf %{buildroot}
mkdir -p %{buildroot}%{_prefix}
mkdir -p %{buildroot}%{_libdir}
mkdir -p %{buildroot}%{_includedir}
mkdir -p %{buildroot}%{_includedir}
mkdir -p %{buildroot}%{_datadir}
ASCEND_MODELS = `ascend-config --models`
mkdir -p %{buildroot}$ASCEND_MODELS
scons %{?_smp_mflags} \
	INSTALL_PREFIX=%{buildroot}%{_prefix} \
	INSTALL_SHARE=%{buildroot}%{_datadir}

%install
scons %{?_smp_mflags} install -i

# Fix uninstalled files
mkdir -p %{buildroot}%{_libdir}/python%{pyver}/site-packages/
cp python/freesteam.py %{buildroot}%{_libdir}/python%{pyver}/site-packages/
cp python/_freesteam.so %{buildroot}%{_libdir}/python%{pyver}/site-packages/

mkdir -p %{buildroot}$ASCEND_MODELS
cp ascend/testfreesteam.a4c %{buildroot}$ASCEND_MODELS
cp ascend/libfreesteam.so %{buildroot}$ASCEND_MODELS

%clean
rm -rf %{buildroot} 

%post
/sbin/ldconfig

%postun
/sbin/ldconfig

%files
%defattr(-, root, root)
%doc README.html INSTALL.html LICENSE.txt
%{_includedir}/%{name}/*.h
%{_libdir}/libfreesteam.a
%{_libdir}/python%{pyver}/site-packages/freesteam.py*
%{_libdir}/python%{pyver}/site-packages/_freesteam.so
$ASCEND_MODELS/libfreesteam.so
$ASCEND_MODELS/testfreesteam.a4c

%changelog
* Wed Oct 25 2006 John Pye <john.pye@student.unsw.edu.au> 0.6.1-0
- Added to sf.net CVS repository, updating for use with scons

* Wed Sep 27 2006 Christophe Trophime <christophe.trophime@grenoble.cnrs.fr>
- Initial build for fc5

