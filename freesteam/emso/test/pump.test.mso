#* 
	freesteam stream integration for use in steam system calculations
	
	Based on steam.mso by Rafael de Pelegrini Soares,

	Copyright 2002-2005 Rafael de Pelegrini Soares.
	Modified by John Pye 2005 http://freesteam.sf.net
	
	This copyright statement must not be deleted and must be
	included in any modification or adaptation of this Model.
*#

using "streams";
using "pump";

#*
	Pump in terms of inlet state, efficiency and outlet pressure
	
	THIS FLOWSHEET WORKS
*#
FlowSheet PumpSimpleTest1
	
	DEVICES
	S1 as Stream_ph;
	PU as PumpSimple;
	
	CONNECTIONS
	S1 to PU.In;
	
	SET
	PU.eta = 0.9;
	
	SPECIFY
	
	"Flow rate"
	S1.mdot = 1 * "kg/s";
	
	"Inlet pressure"
	S1.p = 1 * "bar";
	
	"Inlet temperature"
	S1.T = (25 + 273.15) * "K";
	
	"Output pressure"
	PU.Out.p = 1.3 * "bar";
	
	GUESS
	PU.Out.mdot = 1 * "kg/s";
	
	OPTIONS
	mode = "steady";
	outputLevel = "all";
end

#*
	Similar to above but greater pressure range
	
	THIS FLOWSHEET WORKS
*#
FlowSheet PumpSimpleTest2
	
	DEVICES
	S1 as Stream_pT;
	PU as PumpSimple;
	
	CONNECTIONS
	S1 to PU.In;
	
	SET
	PU.eta = 1;

	SPECIFY
	S1.mdot = 30 * "kg/s";
	
	S1.p = 1.5 * "bar";
	S1.T = 380 * "K";
	
	
	PU.Out.p = 60 * "bar";
	
	OPTIONS
	mode = "steady";
	outputLevel = "all";
end


#*
	Similar to above but Dp instead of Out.p

	THIS FLOWSHEET WORKS
*#
FlowSheet PumpSimpleTest3
	
	DEVICES
	S1 as Stream_pT;
	PU as PumpSimple;
	
	CONNECTIONS
	S1 to PU.In;
	
	SET
	PU.eta = 0.65;
	
	SPECIFY
	S1.mdot = 30 * "kg/s";
	
	S1.p = 1.5 * "bar";
	S1.T = 380 * "K";
	
	PU.Dp = 58.5 * "bar";
	
	OPTIONS
	mode = "steady";
	outputLevel = "all";
end

#*
	Pump with performance curves. The inlet state, parabolic H-Q curve and linear P-Q curve
	are specified, then the operating point is determined by specifying the pump speed
	and head

	DOESN'T WORK
*#
FlowSheet PumpParabolicSimpleTest1

	DEVICES
	S1 as Stream_pT;
	PU as PumpParabolicSimple;
	
	CONNECTIONS
	S1 to PU.In;

	SPECIFY
	# Inlet conditions
	S1.mdot= 5 * "kg/s"; # = approx 5 L/s
	S1.p = 50 * "bar";
	S1.T = (200 + 273.15) * "K";
	
	# Reference speed
	PU.N_1 = 990 * "1/min"; # 2000 RPM
	
	# Head curve
	PU.z_max = 150 * "m";
	PU.Vdot_max = 8000 * "m^3/h"; # 10 L/s
	
	# Power curve
	PU.a_wdot = 20 * "kW/(m^3/s)";
	PU.b_wdot = 360 * "kW";
	
	# Operating point
	PU.N = 990 * "1/min"; # 3000 RPM
	
	# PU.Out.p = 60 * "bar";
	PU.z = 100 * "m";
	
	OPTIONS
	mode="steady";
	outputLevel = "all";	
end


#*
	As above but use a completely self-contained pump-with-curve model

	DOESN'T SOLVE (initially singular)
*#
FlowSheet PumpParabolicSimpleSelfContained1

	DEVICES
	S1 as Stream_pT;
	PU as PumpParabolicSimpleSelfContained;
	
	CONNECTIONS
	S1 to PU.In;

	SPECIFY
	# Inlet conditions
	# S1.mdot= (1000 *"kg/m^3") * 5 * (0.001 * "m^3/s"); # 5 L/s
	S1.p = 50 * "bar";
	S1.T = (200 + 273.15) * "K";
	
	PU.Vdot = 0.001 * "m^3/s";
	
	# Reference speed
	PU.N_1 = 990 * "1/min"; # 2000 RPM
	
	# Head curve
	PU.z_max = 150 * "m";
	PU.Vdot_max = 8000 * "m^3/h"; # 10 L/s
	
	# Power curve
	PU.a_wdot = 20 * "kW/(m^3/s)";
	PU.b_wdot = 360 * "kW";
	
	# Operating point
	PU.N = 990 * "1/min"; # 3000 RPM
	
	PU.Out.p = 60 * "bar";
	# PU.z = 100 * "m";
	
	OPTIONS
	mode="steady";
	outputLevel = "all";	
end
