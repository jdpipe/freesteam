using "pipe2steady";
using "streams";

FlowSheet Pipe2SteadyTest
	PARAMETERS
	freesteam as CalcObject(File="emsofreesteam");
	p_in as Pressure;
	p_out as Pressure;
	
	DEVICES
	S1 as Stream_pT;
	P as Pipe2Steady;

	CONNECTIONS
	S1 to P.In;

	SET
	P.n = 100;
	P.D = 0.05 * "m";
	P.L = 20 * "m";
	P.eps = 1e-5 * "m";
	
	p_in = 60 * "bar";
	p_out = 50 * "bar";
	
	SPECIFY
	S1.p = p_in;
	S1.T = (273.15 + 160) * "K";
	S1.mdot = 7 * "kg/s";
	# P.X(P.n).p = p_out;
	
	GUESS
	P.X([1:P.n]).rho = 997 *"kg/m^3";
	P.X([1:P.n]).mdot = 0.2 * "kg/s";
	P.X([1:P.n]).u = 150 *"kJ/kg";
	
	#*INITIAL
	# Set the internal state along internal nodes of the pipe
	P.X([2:P.n]).p = p_in + (p_out - p_in)/(P.n - 1)*([2:P.n]);
	
	P.X([2:P.n]).u = freesteam.u_pT(1 * "bar",(273.15+25) * "K");
	P.X([2:P.n]).mdot = 0 * "kg/s";
	
	# Set the initial outlet flowrate
	# P.Out.u = 500 * "kJ/kg";
	*#
	
	OPTIONS
	mode="steady";
	outputLevel="high";
	time=[0:0.05:1] * "s";
	
end
