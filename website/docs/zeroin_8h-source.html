<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<html><head><meta http-equiv="Content-Type" content="text/html;charset=UTF-8">
<title>freesteam: zeroin.h Source File</title>
<link href="doxygen.css" rel="stylesheet" type="text/css">
<link href="tabs.css" rel="stylesheet" type="text/css">
</head><body>
<!-- Generated by Doxygen 1.5.6 -->
<div class="navigation" id="top">
  <div class="tabs">
    <ul>
      <li><a href="index.html"><span>Main&nbsp;Page</span></a></li>
      <li><a href="pages.html"><span>Related&nbsp;Pages</span></a></li>
      <li><a href="namespaces.html"><span>Namespaces</span></a></li>
      <li><a href="annotated.html"><span>Classes</span></a></li>
      <li class="current"><a href="files.html"><span>Files</span></a></li>
      <li><a href="examples.html"><span>Examples</span></a></li>
    </ul>
  </div>
<h1>zeroin.h</h1><a href="zeroin_8h.html">Go to the documentation of this file.</a><div class="fragment"><pre class="fragment"><a name="l00001"></a>00001 <span class="comment">/*</span>
<a name="l00002"></a>00002 <span class="comment"></span>
<a name="l00003"></a>00003 <span class="comment">freesteam - IAPWS-IF97 steam tables library</span>
<a name="l00004"></a>00004 <span class="comment">Copyright (C) 2004-2005  John Pye</span>
<a name="l00005"></a>00005 <span class="comment"></span>
<a name="l00006"></a>00006 <span class="comment">This program is free software; you can redistribute it and/or</span>
<a name="l00007"></a>00007 <span class="comment">modify it under the terms of the GNU General Public License</span>
<a name="l00008"></a>00008 <span class="comment">as published by the Free Software Foundation; either version 2</span>
<a name="l00009"></a>00009 <span class="comment">of the License, or (at your option) any later version.</span>
<a name="l00010"></a>00010 <span class="comment"></span>
<a name="l00011"></a>00011 <span class="comment">This program is distributed in the hope that it will be useful,</span>
<a name="l00012"></a>00012 <span class="comment">but WITHOUT ANY WARRANTY; without even the implied warranty of</span>
<a name="l00013"></a>00013 <span class="comment">MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the</span>
<a name="l00014"></a>00014 <span class="comment">GNU General Public License for more details.</span>
<a name="l00015"></a>00015 <span class="comment"></span>
<a name="l00016"></a>00016 <span class="comment">You should have received a copy of the GNU General Public License</span>
<a name="l00017"></a>00017 <span class="comment">along with this program; if not, write to the Free Software</span>
<a name="l00018"></a>00018 <span class="comment">Foundation, Inc., 59 Temple Place - Suite 330, Boston, MA  02111-1307, USA.</span>
<a name="l00019"></a>00019 <span class="comment"></span>
<a name="l00020"></a>00020 <span class="comment">*/</span>
<a name="l00021"></a>00021 
<a name="l00022"></a>00022 <span class="preprocessor">#ifndef ZEROINVISITOR_H</span>
<a name="l00023"></a>00023 <span class="preprocessor"></span><span class="preprocessor">#define ZEROINVISITOR_H</span>
<a name="l00024"></a>00024 <span class="preprocessor"></span>
<a name="l00025"></a>00025 <span class="preprocessor">#include "<a class="code" href="designbycontract_8h.html">designbycontract.h</a>"</span>
<a name="l00026"></a>00026 
<a name="l00027"></a>00027 <span class="preprocessor">#include &lt;iostream&gt;</span>
<a name="l00028"></a>00028 <span class="preprocessor">#include &lt;cmath&gt;</span>
<a name="l00029"></a>00029 
<a name="l00030"></a>00030 <span class="preprocessor">#ifndef DBL_EPSILON</span>
<a name="l00031"></a><a class="code" href="zeroin_8h.html#b701824136346377b44fc3adb8050b29">00031</a> <span class="preprocessor"></span><span class="preprocessor">        #define DBL_EPSILON 2e-16</span>
<a name="l00032"></a>00032 <span class="preprocessor"></span><span class="preprocessor">#endif</span>
<a name="l00033"></a>00033 <span class="preprocessor"></span>
<a name="l00035"></a>00035 
<a name="l00076"></a>00076 <span class="keyword">template</span> &lt; <span class="keyword">class</span> Subject, <span class="keyword">class</span> Ordinate = <span class="keywordtype">double</span>, <span class="keyword">class</span> Abscissa = <span class="keywordtype">double</span> &gt;
<a name="l00077"></a><a class="code" href="class_zero_in.html">00077</a> <span class="keyword">class </span><a class="code" href="class_zero_in.html">ZeroIn</a> : <span class="keyword">public</span> <a class="code" href="class_design_by_contract.html" title="Design-by-contract base class.">DesignByContract</a> {
<a name="l00078"></a>00078 
<a name="l00079"></a>00079     <span class="keyword">private</span>:
<a name="l00080"></a>00080     Abscissa ax;                
<a name="l00081"></a>00081     Abscissa bx;                
<a name="l00082"></a>00082     Ordinate(Subject::*method) (<span class="keyword">const</span> Abscissa&amp;);       
<a name="l00083"></a>00083     Abscissa tol;               
<a name="l00084"></a>00084     Abscissa x;                 
<a name="l00085"></a>00085     <span class="keywordtype">bool</span> issolved;
<a name="l00086"></a>00086 
<a name="l00087"></a>00087     Abscissa a, b, c;           
<a name="l00088"></a>00088     Ordinate fa;                
<a name="l00089"></a>00089     Ordinate fb;                
<a name="l00090"></a>00090     Ordinate fc;                
<a name="l00091"></a>00091 
<a name="l00092"></a>00092     Subject *subject;
<a name="l00093"></a>00093 
<a name="l00094"></a>00094     <span class="keyword">public</span>:
<a name="l00095"></a>00095 
<a name="l00096"></a><a class="code" href="class_zero_in.html#ed03311b51970da67e0916c18b65b208">00096</a>     <a class="code" href="class_zero_in.html#ed03311b51970da67e0916c18b65b208">ZeroIn</a>() {
<a name="l00097"></a>00097             this-&gt;tol = 0.0 * Abscissa();
<a name="l00098"></a>00098     }
<a name="l00099"></a>00099 
<a name="l00101"></a><a class="code" href="class_zero_in.html#6888900aeb80dd9e2ae26184ecab5386">00101</a>     <span class="keywordtype">void</span> <a class="code" href="class_zero_in.html#6888900aeb80dd9e2ae26184ecab5386" title="Set the lower bound of the range that will be searched for a solution.">setLowerBound</a>(<span class="keyword">const</span> Abscissa&amp; ax) {
<a name="l00102"></a>00102             this-&gt;ax = ax;
<a name="l00103"></a>00103     }
<a name="l00104"></a>00104 
<a name="l00106"></a><a class="code" href="class_zero_in.html#ee47eec992b3284bef7a6b2a9c4fcb1a">00106</a>     Abscissa <a class="code" href="class_zero_in.html#ee47eec992b3284bef7a6b2a9c4fcb1a">getLowerBound</a>()<span class="keyword"> const </span>{
<a name="l00107"></a>00107             <span class="keywordflow">return</span> ax;
<a name="l00108"></a>00108     }
<a name="l00109"></a>00109 
<a name="l00111"></a><a class="code" href="class_zero_in.html#36c160abf4f0769a41cc90b4301238ed">00111</a>     <span class="keywordtype">void</span> <a class="code" href="class_zero_in.html#36c160abf4f0769a41cc90b4301238ed" title="Set the upper bound of the range that will be searched for a solution.">setUpperBound</a>(<span class="keyword">const</span> Abscissa&amp; bx) {
<a name="l00112"></a>00112             this-&gt;bx = bx;
<a name="l00113"></a>00113     }
<a name="l00114"></a>00114 
<a name="l00116"></a><a class="code" href="class_zero_in.html#be1a36e59bf11b79e859c1d9238b95b4">00116</a>     Abscissa <a class="code" href="class_zero_in.html#be1a36e59bf11b79e859c1d9238b95b4">getUpperBound</a>()<span class="keyword"> const</span>{
<a name="l00117"></a>00117             <span class="keywordflow">return</span> bx;
<a name="l00118"></a>00118     }
<a name="l00119"></a>00119 
<a name="l00121"></a><a class="code" href="class_zero_in.html#689f901a921b1f1e74118ed410e8a8f9">00121</a>     <span class="keywordtype">void</span> <a class="code" href="class_zero_in.html#689f901a921b1f1e74118ed410e8a8f9" title="set tolerance of the solution">setTolerance</a>(<span class="keyword">const</span> Abscissa&amp; tol) {
<a name="l00122"></a>00122             this-&gt;tol = tol;
<a name="l00123"></a>00123     }
<a name="l00124"></a>00124 
<a name="l00126"></a>00126 
<a name="l00134"></a><a class="code" href="class_zero_in.html#be705507c1b4a3d8e1c97fdb6c0aa90e">00134</a>     <span class="keywordtype">void</span> <a class="code" href="class_zero_in.html#be705507c1b4a3d8e1c97fdb6c0aa90e">setMethod</a>(Ordinate(Subject::*method) (<span class="keyword">const</span> Abscissa&amp;)) {
<a name="l00135"></a>00135             this-&gt;method = method;
<a name="l00136"></a>00136     }
<a name="l00137"></a>00137 
<a name="l00139"></a>00139 
<a name="l00182"></a><a class="code" href="class_zero_in.html#5cd3dbd70509125cb1758f496fb33596">00182</a>     <span class="keywordtype">void</span> <a class="code" href="class_zero_in.html#5cd3dbd70509125cb1758f496fb33596" title="ZeroIn visit method.">visit</a>(Subject *subject) {
<a name="l00183"></a>00183 
<a name="l00184"></a>00184             <span class="comment">//cerr &lt;&lt; "Begin zeroin with lower bound " &lt;&lt; K_TO_C(getLowerBound()) &lt;&lt; "°C and upper bound " &lt;&lt; K_TO_C(getUpperBound()) &lt;&lt; endl;</span>
<a name="l00185"></a>00185 
<a name="l00186"></a>00186             this-&gt;subject = subject;
<a name="l00187"></a>00187             this-&gt;issolved = <span class="keyword">false</span>;
<a name="l00188"></a>00188 
<a name="l00189"></a>00189             a = ax;
<a name="l00190"></a>00190             b = bx;
<a name="l00191"></a>00191             fa = ((*subject).*method) (a);
<a name="l00192"></a>00192             fb = ((*subject).*method) (b);
<a name="l00193"></a>00193             c = a;
<a name="l00194"></a>00194             fc = fa;
<a name="l00195"></a>00195 
<a name="l00196"></a>00196                 <span class="keywordflow">if</span>(fa == 0.0 * Ordinate()){
<a name="l00197"></a>00197                         fb=0.0 * Ordinate(); <span class="comment">// used by getError</span>
<a name="l00198"></a>00198                         this-&gt;issolved = <span class="keyword">true</span>; <span class="comment">// perfect solution</span>
<a name="l00199"></a>00199                         <span class="keywordflow">return</span>;
<a name="l00200"></a>00200                 }
<a name="l00201"></a>00201 
<a name="l00202"></a>00202             <span class="comment">//  Main iteration loop</span>
<a name="l00203"></a>00203 
<a name="l00204"></a>00204             <span class="keywordflow">for</span> (;;) {
<a name="l00205"></a>00205                     Abscissa prev_step = b - a;    
<a name="l00206"></a>00206                     Abscissa tol_act;                
<a name="l00207"></a>00207                     Abscissa p;                    
<a name="l00208"></a>00208                     <span class="keywordtype">double</span> q;                      
<a name="l00209"></a>00209                     Abscissa new_step;             
<a name="l00210"></a>00210 
<a name="l00211"></a>00211                     <span class="keywordflow">if</span> (<a class="code" href="units_8h.html#b2654a4aabeaa9e3e88b759b09532529">fabs</a>(fc) &lt; <a class="code" href="units_8h.html#b2654a4aabeaa9e3e88b759b09532529">fabs</a>(fb)) {
<a name="l00212"></a>00212                             a = b;
<a name="l00213"></a>00213                             b = c;
<a name="l00214"></a>00214                             c = a;  <span class="comment">//  Swap data for b to be the best approximation</span>
<a name="l00215"></a>00215                             fa = fb;
<a name="l00216"></a>00216                             fb = fc;
<a name="l00217"></a>00217                             fc = fa;
<a name="l00218"></a>00218                     }
<a name="l00219"></a>00219 
<a name="l00220"></a>00220                     <span class="comment">// DBL_EPSILON is defined in math.h</span>
<a name="l00221"></a>00221                     tol_act = 2.0* <a class="code" href="zeroin_8h.html#b701824136346377b44fc3adb8050b29">DBL_EPSILON</a> * <a class="code" href="units_8h.html#b2654a4aabeaa9e3e88b759b09532529">fabs</a>(b) + tol / 2.0;
<a name="l00222"></a>00222 
<a name="l00223"></a>00223                     new_step = (c - b) / 2.0;
<a name="l00224"></a>00224 
<a name="l00225"></a>00225                     <span class="keywordflow">if</span> (<a class="code" href="units_8h.html#b2654a4aabeaa9e3e88b759b09532529">fabs</a>(new_step) &lt;= tol_act || fb == 0.0 * Ordinate()) {
<a name="l00226"></a>00226                             this-&gt;issolved = <span class="keyword">true</span>;       <span class="comment">//  Acceptable approx. is found</span>
<a name="l00227"></a>00227                             <span class="comment">//cerr &lt;&lt; "Best solution is b, f(b=" &lt;&lt; b &lt;&lt; ")=" &lt;&lt; fb &lt;&lt;",f(a="&lt;&lt;a&lt;&lt;")="&lt;&lt; fa &lt;&lt;endl;</span>
<a name="l00228"></a>00228                             <span class="keywordflow">return</span>;
<a name="l00229"></a>00229                     }
<a name="l00230"></a>00230                     <span class="comment">//  Decide if the interpolation can be tried</span>
<a name="l00231"></a>00231 
<a name="l00232"></a>00232                     <span class="keywordflow">if</span> (<a class="code" href="units_8h.html#b2654a4aabeaa9e3e88b759b09532529">fabs</a>(prev_step) &gt;= tol_act   <span class="comment">// If prev_step was large enough and was in true direction,</span>
<a name="l00233"></a>00233                         &amp;&amp; <a class="code" href="units_8h.html#b2654a4aabeaa9e3e88b759b09532529">fabs</a>(fa) &gt; <a class="code" href="units_8h.html#b2654a4aabeaa9e3e88b759b09532529">fabs</a>(fb))      <span class="comment">// Interpolatiom may be tried</span>
<a name="l00234"></a>00234                     {
<a name="l00235"></a>00235                             <span class="keyword">register</span> <span class="keywordtype">double</span> t1, t2;
<a name="l00236"></a>00236                             Abscissa cb;
<a name="l00237"></a>00237 
<a name="l00238"></a>00238                             cb = c - b;
<a name="l00239"></a>00239                             <span class="keywordflow">if</span> (a == c) {
<a name="l00240"></a>00240                                     <span class="comment">// If we have only two distinct points</span>
<a name="l00241"></a>00241                                     <span class="comment">// then only linear interpolation can be applied</span>
<a name="l00242"></a>00242                                     t1 = fb / fa;
<a name="l00243"></a>00243                                     p = cb * t1;
<a name="l00244"></a>00244                                     q = 1.0 - t1;
<a name="l00245"></a>00245                             } <span class="keywordflow">else</span> {
<a name="l00246"></a>00246                                     <span class="comment">// Quadric inverse interpolation</span>
<a name="l00247"></a>00247 
<a name="l00248"></a>00248                                     q = fa / fc;
<a name="l00249"></a>00249                                     t1 = fb / fc;
<a name="l00250"></a>00250                                     t2 = fb / fa;
<a name="l00251"></a>00251                                     p = t2 * (cb * q * (q - t1) - (b - a) * (t1 - 1.0));
<a name="l00252"></a>00252                                     q = (q - 1.0) * (t1 - 1.0) * (t2 - 1.0);
<a name="l00253"></a>00253                             }
<a name="l00254"></a>00254                             <span class="keywordflow">if</span> (p &gt; 0.0 * Abscissa()) {
<a name="l00255"></a>00255                                     <span class="comment">// p was calculated with the opposite sign; make p positive-</span>
<a name="l00256"></a>00256                                     q = -q;     <span class="comment">// and assign possible minus to q</span>
<a name="l00257"></a>00257                             } <span class="keywordflow">else</span> {
<a name="l00258"></a>00258                                     p = -p;
<a name="l00259"></a>00259                             }
<a name="l00260"></a>00260 
<a name="l00261"></a>00261                             <span class="keywordflow">if</span> (p &lt; (0.75 * cb * q - <a class="code" href="units_8h.html#b2654a4aabeaa9e3e88b759b09532529">fabs</a>(tol_act * q) / 2.0)
<a name="l00262"></a>00262                                 &amp;&amp; p &lt; <a class="code" href="units_8h.html#b2654a4aabeaa9e3e88b759b09532529">fabs</a>(prev_step * q / 2.0)
<a name="l00263"></a>00263                                ) {
<a name="l00264"></a>00264                                     <span class="comment">// If b+p/q falls in [b,c] and</span>
<a name="l00265"></a>00265                                     <span class="comment">// isn't too large it is accepted</span>
<a name="l00266"></a>00266                                     new_step = p / q;
<a name="l00267"></a>00267                             }
<a name="l00268"></a>00268                             <span class="comment">// If p/q is too large then the bissection procedure can</span>
<a name="l00269"></a>00269                             <span class="comment">// reduce [b,c] range to more extent</span>
<a name="l00270"></a>00270                     }
<a name="l00271"></a>00271 
<a name="l00272"></a>00272                     <span class="keywordflow">if</span> (<a class="code" href="units_8h.html#b2654a4aabeaa9e3e88b759b09532529">fabs</a>(new_step) &lt; tol_act) {     <span class="comment">// Adjust the step to be not less</span>
<a name="l00273"></a>00273                             <span class="keywordflow">if</span> (new_step &gt; 0.0 * Abscissa())    <span class="comment">// than tolerance</span>
<a name="l00274"></a>00274                                     new_step = tol_act;
<a name="l00275"></a>00275                             <span class="keywordflow">else</span>
<a name="l00276"></a>00276                                     new_step = -tol_act;
<a name="l00277"></a>00277                     }
<a name="l00278"></a>00278 
<a name="l00279"></a>00279                     a = b;
<a name="l00280"></a>00280                     fa = fb;            <span class="comment">// Save the previous approx.</span>
<a name="l00281"></a>00281                     b += new_step;
<a name="l00282"></a>00282                     fb = ((*subject).*method) (b);      <span class="comment">//  Do step to a new approxim.</span>
<a name="l00283"></a>00283 
<a name="l00284"></a>00284                     <span class="keywordflow">if</span> ((fb &gt; 0.0 * Ordinate() &amp;&amp; fc &gt; 0.0 * Ordinate())
<a name="l00285"></a>00285                         || (fb &lt; 0.0 * Ordinate() &amp;&amp; fc &lt; 0.0 * Ordinate())) {
<a name="l00286"></a>00286                             c = a;
<a name="l00287"></a>00287                             fc = fa;    <span class="comment">//  Adjust c for it to have a sign opposite to that of b</span>
<a name="l00288"></a>00288                     }
<a name="l00289"></a>00289             }
<a name="l00290"></a>00290             <span class="comment">// (((we never arrive here)))</span>
<a name="l00291"></a>00291     }
<a name="l00292"></a>00292 
<a name="l00293"></a><a class="code" href="class_zero_in.html#c96b369777f5f8c41cc1acb3eed4f9e9">00293</a>     <span class="keywordtype">bool</span> <a class="code" href="class_zero_in.html#c96b369777f5f8c41cc1acb3eed4f9e9">isSolved</a>(<span class="keywordtype">void</span>)<span class="keyword"> const</span>{
<a name="l00294"></a>00294             <span class="keywordflow">return</span> issolved;
<a name="l00295"></a>00295     }
<a name="l00296"></a>00296 
<a name="l00297"></a><a class="code" href="class_zero_in.html#4890c09ae55c08a5a12dd49f3f9cc657">00297</a>     <span class="keywordtype">bool</span> <a class="code" href="class_zero_in.html#c96b369777f5f8c41cc1acb3eed4f9e9">isSolved</a>(<span class="keyword">const</span> Ordinate &amp;error) {
<a name="l00298"></a>00298             <span class="keywordflow">if</span> (<a class="code" href="units_8h.html#b2654a4aabeaa9e3e88b759b09532529">fabs</a>(fb) &gt; error) {
<a name="l00299"></a>00299                     <span class="keywordflow">return</span> <span class="keyword">false</span>;
<a name="l00300"></a>00300             }
<a name="l00301"></a>00301             <span class="keywordflow">return</span> <span class="keyword">true</span>;
<a name="l00302"></a>00302     }
<a name="l00303"></a>00303 
<a name="l00304"></a><a class="code" href="class_zero_in.html#1b0d387172e833f1dfb40d6a3c6afd03">00304</a>     Abscissa <a class="code" href="class_zero_in.html#1b0d387172e833f1dfb40d6a3c6afd03">getSolution</a>(<span class="keywordtype">void</span>)<span class="keyword"> const </span>{
<a name="l00305"></a>00305             <span class="keywordflow">return</span> a;
<a name="l00306"></a>00306     }
<a name="l00307"></a>00307 
<a name="l00308"></a><a class="code" href="class_zero_in.html#6ae374c1d576b935bbd395373cbf128e">00308</a>     Ordinate <a class="code" href="class_zero_in.html#6ae374c1d576b935bbd395373cbf128e">getError</a>(<span class="keywordtype">void</span>)<span class="keyword"> const</span>{
<a name="l00309"></a>00309             <span class="keywordflow">return</span> fb;
<a name="l00310"></a>00310     }
<a name="l00311"></a>00311 };
<a name="l00312"></a>00312 
<a name="l00313"></a>00313 <span class="preprocessor">#endif</span>
</pre></div></div>
<hr size="1"><address style="text-align: right;"><small>Generated on Tue Feb 10 18:37:37 2009 for freesteam by&nbsp;
<a href="http://www.doxygen.org/index.html">
<img src="doxygen.png" alt="doxygen" align="middle" border="0"></a> 1.5.6 </small></address>
</body>
</html>
