using "newtypes";

#*
	Trying to add fluid properties to SimpleLoop3
*#
FlowSheet SimpleLoop5Test
	
	PARAMETERS	

	# Pump
	eta as Real; # Pump efficiency
	
	# Tanks
	y_0 as Length;
	A as Area;
	k as Real(Unit="N/m", Lower=0, Upper=1e9, Default=1);

	# Valve
	K_v as Real;
	A_v as Area;
	
	v as SpecificVolume;
	
	m_total as Mass;

	H_0 as Length(Brief = "Pump head at zero flow");
	H_2 as Real(Unit="m/(m^3/s)^2", Brief="Curvature of pump head curve");
	
	VARIABLES
	p_T1 as Pressure;
	p_T2 as Pressure;
	mdot_p as MassFlowRate;
	mdot_v as MassFlowRate;
	
	# Tank 1
	m_T1 as Mass;
	y_T1 as Length;

	# Tank 2
	m_T2 as Mass;
	y_T2 as Length;
	
	# Throttle
	vel as Velocity;

	Dp as Pressure;

	EQUATIONS	
	# Pump rules
	Dp = p_T1 - p_T2;
	Dp * v = (9.8 * "N/kg") * (H_0 - H_2 * (mdot_p * v ) ^2);
	
	# Tank 1
	mdot_p - mdot_v = diff(m_T1);
	
	v * m_T1 = A * y_T1;
	p_T1 = k * (y_T1 - y_0) / A;
	
	# Throttle
	Dp = K_v * 0.5 / v * vel^2;
	vel = v * mdot_v / A_v;
	
	# Tank 2
	v * m_T2 = A * y_T2;
	p_T2 = k * (y_T2 - y_0) / A;
	
	m_T1 + m_T2 = m_total;

	SET
	v = 0.001 * "m^3/kg";
	m_total = 3000 * "kg";
	
	# Pump
	eta = 0.65;

	# Tanks
	A = 1 * "m^2";
	k = 1 * "bar" / (0.1 * "m") * (1 * "m^2");
	y_0 = 0.8 * "m";
	
	# Throttle
	A_v = 3.1415926 * (0.01 * "m")^2 / 4;
	K_v = 0.01;

	H_0 = 5 * "m";
	H_2 = 5 * "m" / (0.01 * "m^3/s")^2;
	
	INITIAL
	mdot_v = 1e-5 * "kg/s";
	
	OPTIONS
	differentiation="numeric";
	# mode="steady";
	outputLevel="high";
	time = [0 : 0.1 : 20] * "s";
end
