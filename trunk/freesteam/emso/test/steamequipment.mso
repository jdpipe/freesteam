#* 
	freesteam stream integration for use in steam system calculations
	
	Based on steam.mso by Rafael de Pelegrini Soares,

	Copyright 2002-2005 Rafael de Pelegrini Soares.
	Modified by John Pye 2005 http://freesteam.sf.net
	
	This copyright statement must not be deleted and must be
	included in any modification or adaptation of this Model.
*#

using "newtypes";

#** 
	Basic steam equipment item with one inlet and outlet stream.
*#
Model SteamEquipment

	PARAMETERS
	ext freesteam as CalcObject(Brief="Steam Physical Properties");

	VARIABLES
in	In  as Stream_Base;
out	Out as Stream_ps;	
end


#* 
	Ideal (isentropic) turbine
*#
Model Turbine_Ideal as SteamEquipment

	VARIABLES
	P     as Power(Brief="Turbine Power");

	EQUATIONS
	"Mass Balance"
	In.mdot = Out.mdot;
	
	"Turbine power"
	P = In.mdot * (In.h - Out.h);
	
	"Isentropic constraint"
	Out.s = In.s;

	"Outlet properties"
	[Out.T, Out.s, Out.v, Out.x] = freesteam.Tsvx_ph(Out.p, Out.h);
end


#* 
	Turbine (non-isentropic, with efficiency specified)
*#
Model Turbine as SteamEquipment

	VARIABLES
	eta as Efficiency(Brief="Tubine efficiency");
	P as Power;
	
	EQUATIONS
	"Mass Balance"
	In.mdot = Out.mdot;
	
	"Potency"
	P = In.mdot * (In.h - Out.h);
	
	"Efficiency"
	(Out.h - In.h) = eta * (freesteam.h_ps(Out.p, In.s) - In.h);

end

#*	Steam Condenser.

	This model receives one In strem from which a quantity of heat q
	is removed.

	Specification for this model can be q or dt. The specification of q
	should be prefered, once a bad specificafion of dt can lead singular
	systems (infinite solutions if the Out stream became saturated).
*#
Model Condenser as SteamEquipment
	
	VARIABLES
	q	as HeatRate(Brief="Heat removed from the stream");
	DT  as Temperature(Brief="Temperature difference");

	EQUATIONS
	"Mass balance"
	Out.mdot = In.mdot;
	
	"Energy balance"
	q = (In.h - Out.h) * In.mdot;
	
	"Pressure"
	Out.p = In.p;
	
	"Temperature difference"
	DT = In.T - Out.T;
	
	"Out Stream"
	[Out.T, Out.s, Out.v, Out.x] = freesteam.Tsvx_ph(Out.p, Out.h);

#	GUESS # FIXME: implement GUESS on models!!
#	Out.h = 300 * "kJ/kg";

end

# CondenserPT removed...

#*
	Steam pump

	Includes isentropic efficiency

	You can specify one of the pressures (In or Out) plus P or eta
*#
Model Pump as SteamEquipment
	
	VARIABLES
	P   as Power(Brief="Nominal power");
	eta as Efficiency(Brief="Pump efficiency");
	
	EQUATIONS
	"Mass balance"
	Out.mdot = In.mdot;
	
	"Energy balance"
	P * eta = In.mdot * (Out.p - In.p) * freesteam.v_ps(In.p, In.s);
	
	# FIXME: Volume at In or Out conditions ?
	
	"Efficiency"
	(Out.h - In.h) = eta * (freesteam.h_ps(Out.p, In.s) - In.h);

	"Out Stream"
	[Out.T, Out.s, Out.v, Out.x] = freesteam.Tsvx_ph(Out.p, Out.h);
end

#*
	Isenthalpic throttle
*#
Model Throttle as SteamEquipment

	EQUATIONS
	Out.h = In.h;
	
end

#*
	Boiler

	Specify outlet pressure plus q or outlet temperature
*#
Model Boiler as SteamEquipment
	
	VARIABLES
	q	as HeatRate;

	EQUATIONS
	"Mass balance"
	Out.mdot = In.mdot;

	"Energy balance"
	q = Out.mdot * Out.h - In.mdot * In.h;
	
	"Outlet stream"
	
	# [Out.s, Out.h, Out.x] = freesteam.shx_pT(Out.p, Out.T);
	[Out.T, Out.s, Out.v, Out.x] = freesteam.Tsvx_ph(Out.p, Out.h);
	
#	[Out.T, Out.s, Out.x] = freesteam.StreamPH(Out.P, Out.h);
end
