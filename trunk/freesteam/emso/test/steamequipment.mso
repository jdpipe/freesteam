#* 
    freesteam stream integration for use in steam system calculations
    
    Originally based on code by Rafael de Pelegrini Soares
	Modified by John Pye 2005 http://freesteam.sf.net
*#

using "streams";

#*
	This 'base' model contains many of the standard variables which all
	steam equipment items should share.

	However because we don't yet know the type of the 'in' and 'out' 
	ports, we can't write any relationships between these.
*#
Model SteamEquipmentBase
	
	VARIABLES
	Qdot as HeatRate(Brief = "Heat supplied to component from environment", Unit="W", Lower=-2e9, Upper=2e9);
	Wdot as Power(Brief = "Work done by fluid on environment", Unit="W", Lower=-2e9, Upper=2e9);
	H as Enthalpy(Brief = "Enthalpy of fluid in the control volume");
	m as Mass(Brief = "Mass of fluid in the control volume");
    DT  as Temperature(Brief="Temperature difference");
    Dp  as PressureDifference(Brief="Pressure difference");	
end
	
#*
    Generic steam equipment item. Includes mass conservation and energy conservation laws.
*#
Model SteamEquipment as SteamEquipmentBase

    VARIABLES
	in  In  as Stream;
	out Out as Stream;
	
	SPECIFY
	# Conservation of energy
	Qdot - Wdot = Out.mdot * Out.h - In.mdot * In.h + diff(H);
	
	# Conservation of mass
	diff(m) = In.mdot - Out.mdot;

    "Temperature difference"
    DT = Out.T - In.T;
    
    "Pressure difference"
    Dp = Out.p - In.p;
end

#*
    Generic steam equipment item. Includes mass conservation and energy conservation laws.
	This version has steam properties added at the outlet port, such that T(p,h) and s(p,h)
	relations are observed.
*#
Model SteamEquipment_ph as SteamEquipmentBase

    VARIABLES
	in  In  as Stream;
	out Out as Stream_ph;   
	
	SPECIFY
	Qdot - Wdot = Out.mdot * Out.h - In.mdot * In.h + diff(H);
	diff(m) = In.mdot - Out.mdot;
	
    "Temperature difference"
    DT = Out.T - In.T;
    
    "Pressure difference"
    Dp = Out.p - In.p;	

end

#*
    Generic steam equipment item. Includes mass conservation and energy conservation laws.
	This version has steam properties added at the outlet port, such that h(p,s) and T(p,s)
	relations are observed.
*#
Model SteamEquipment_ps as SteamEquipmentBase# DF = 8

    VARIABLES
	in  In  as Stream;
	out Out as Stream_ps;   

	SPECIFY
	Qdot - Wdot = Out.mdot * Out.h - In.mdot * In.h + diff(H);
	diff(m) = In.mdot - Out.mdot;
	
    "Temperature difference"
    DT = Out.T - In.T;
    
    "Pressure difference"
    Dp = Out.p - In.p;
end

#*
    Generic steam equipment item. Includes mass conservation and energy conservation laws.
	This version has steam properties added at the outlet port, such that p(T,s) and h(T,s)
	relations are observed.
*#
Model SteamEquipment_Ts as SteamEquipmentBase # DF = 8

    VARIABLES
	in  In  as Stream;
	out Out as Stream_Ts;   
	
	SPECIFY
	Qdot - Wdot = Out.mdot * Out.h - In.mdot * In.h + diff(H);
	diff(m) = In.mdot - Out.mdot;
	
    "Temperature difference"
    DT = Out.T - In.T;
    
    "Pressure difference"
    Dp = Out.p - In.p;
end

#*
    Generic steam equipment item. Includes mass conservation and energy conservation laws.
	This version has steam properties added at the outlet port, such that p(T,h) and s(T,h)
	relations are observed.
*#
Model SteamEquipment_Th as SteamEquipmentBase

    VARIABLES
	in  In  as Stream;
	out Out as Stream_Th;   
	
	SPECIFY
	Qdot - Wdot = Out.mdot * Out.h - In.mdot * In.h + diff(H);
	diff(m) = In.mdot - Out.mdot;
	
    "Temperature difference"
    DT = Out.T - In.T;
    
    "Pressure difference"
    Dp = Out.p - In.p;
end

#*
    Generic steam equipment item. Includes mass conservation and energy conservation laws.
	This version has steam properties added at the outlet port, such that h(p,T) and s(p,T)
	relations are observed.
*#
Model SteamEquipment_pT as SteamEquipmentBase

    VARIABLES
	in  In  as Stream;
	out Out as Stream_pT;   
	
	SPECIFY
	Qdot - Wdot = Out.mdot * Out.h - In.mdot * In.h + diff(H);
	diff(m) = In.mdot - Out.mdot;
	
	"Temperature difference"
    DT = Out.T - In.T;
    
    "Pressure difference"
    Dp = Out.p - In.p;
end

#*
    Generic steam equipment item. Includes mass conservation and energy conservation laws.
	This version has steam properties added at the outlet port, such that p(u,v), T(u,v), h(u,v) and s(u,v)
	relations are observed.
*#
Model SteamEquipment_uv as SteamEquipmentBase

    VARIABLES
	in  In  as Stream;
	out Out as Stream_uv;   
	
	SPECIFY
	Qdot - Wdot = Out.mdot * Out.h - In.mdot * In.h + diff(H);
	diff(m) = In.mdot - Out.mdot;
    
	"Temperature difference"
    DT = Out.T - In.T;
    
    "Pressure difference"
    Dp = Out.p - In.p;	
end
