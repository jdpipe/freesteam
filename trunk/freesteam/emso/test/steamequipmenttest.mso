#* 
	freesteam stream integration for use in steam system calculations
	
	Based on steam.mso by Rafael de Pelegrini Soares,

	Copyright 2002-2005 Rafael de Pelegrini Soares.
	Modified by John Pye 2005 http://freesteam.sf.net
	
	This copyright statement must not be deleted and must be
	included in any modification or adaptation of this Model.
*#

#-------------------------------------------------------------------
# TEST FLOWSHEETS
#
# check that expected values of various stuff are found...
#

FlowSheet TestStreams_ps
	
	PARAMETERS
	freesteam as CalcObject(File="emsofreesteam");
	
	#h_error as SpecificEnthalpy(Default = 200);
	#T_error as RelativeTemperature(Default = 200);
	
	DEVICES
	S as SteamStream_ps;
	
	SPECIFY
	"Flow rate"
	S.mdot = 10 * "kg/s";

	# Region 1 Test Points:
	# (3  MPA, 0.5 kJ/kg/K) -> 307.842 K
	# (80 MPA, 0.5 kJ/kg/K) -> 309.979 K
	# (80 MPA, 3 kJ/kg/K) -> 565.899 K

	# Region 2 Test Points:
	# (0.1  MPA, 7.5 kJ/kg/K) -> 399.517 K
	# (8  MPA, 7.5 kJ/kg/K) -> 1064.95 K
	# (80  MPA, 5.25 kJ/kg/K) -> 854.011 K
	
	"Pressure"
	S.p = 8 * "MPa";
	"Entropy"
	S.s = 7.5 * "kJ/kg/K";
	
	#h_error = S.h - 224.233 * "kJ/kg";
	#T_error = S.T - 309.979 * "K";
	
	#st.h = 224.224 * "kJ/kg";
	#st.T = 309.979 * "K";
	
	OPTIONS
	relativeAccuracy = 1e-10;
	mode = "steady";
	outputLevel = "all";
end

FlowSheet TestTurbine
	
	PARAMETERS
	freesteam as CalcObject(File="emsofreesteam");
	
	DEVICES
	s as SteamStream_ps;
	#t as TurbineIdeal;
	TU as Turbine;
	
	CONNECTIONS
	s to TU.In;
	
	SPECIFY
	"Inlet flowrate"
	s.mdot = 20000 * "kg/h";
	
	"Inlet pressure"
	s.p = 4.32 * "MPa";
	
	"Inlet temperature"
	s.T = 670.65 * "K";
	
	"Efficiency"
	TU.eta = .83;
	#t.Out.T = 550 * "K";
	
	"Outlet pressure"
	TU.Out.p = 1.569 * "MPa";
	#t.Out.P = 0.1 * "MPa";
	
	OPTIONS
	mode = "steady";
	outputLevel = "all";
end

FlowSheet TestCondenser
	
	PARAMETERS
	freesteam as CalcObject(File="emsofreesteam");
	
	DEVICES
	S as SteamStream_ps;
	CO as Condenser;
	
	CONNECTIONS
	S to CO.In;
	
	SPECIFY
	S.mdot = 20000 * "kg/h";
	S.T = 400 * "K";
	S.p = 2 * "atm";
	
	#cond.q = 45 * "GJ/h";
	CO.DT = 10 * "K";
	
	GUESS 
	# FIXME: this is required when DT is specified instead of q
	# CO.Out.h = 300 * "kJ/kg";
	
	OPTIONS
	mode = "steady";
	outputLevel = "all";
end

FlowSheet TestCondenser_ps
	
	PARAMETERS
	freesteam as CalcObject(File="emsofreesteam");
	
	DEVICES
	s as SteamStream_ps;
	cond as Condenser;
	
	CONNECTIONS
	s to cond.In;
	
	SPECIFY
	s.mdot = 20000 * "kg/h";
	s.T = 300 * "K";
	s.p = 2 * "atm";
	
	#cond.q = 45 * "GJ/h";
	cond.DT = 10 * "K";
	cond.Out.p = 2 * "atm";
	
	OPTIONS
	mode = "steady";
	outputLevel = "all";
end

FlowSheet TestPump
	
	PARAMETERS
	freesteam as CalcObject(File="emsofreesteam");
	
	DEVICES
	s as SteamStream_ps;
	pump as Pump;
	
	CONNECTIONS
	s to pump.In;
	
	SPECIFY
	s.mdot = 20000 * "kg/h";
	s.T = 300 * "K";
	s.p = 2 * "atm";
	
	pump.Out.p = 6 * "atm";
	pump.eta = 0.9;
	
	OPTIONS
	mode = "steady";
	outputLevel = "all";
end

FlowSheet TestGenerator
	
	PARAMETERS
	freesteam as CalcObject(File="emsofreesteam");
	
	DEVICES
	s as SteamStream_ps;
	BO as Boiler;
	
	CONNECTIONS
	s to BO.In;
	
	SPECIFY
	s.mdot = 20000 * "kg/h";
	s.T = 300 * "K";
	s.p = 2 * "atm";
	
	BO.Out.p = 2 * "atm";
	BO.Out.T = 400 * "K";
	
	# BO.q = 50 * "GJ/h";
	
	OPTIONS
	mode = "steady";
	outputLevel = "all";
end

FlowSheet TestCycle
	
	PARAMETERS
	freesteam as CalcObject(File="emsofreesteam");
	
    DEVICES
	TU	as Turbine;                  # 6, 8 = 2
	CO	as Condenser;              # 6, 8 = 2
	PU 	as Pump;                # 6, 8 = 2
	BO	as Boiler; # 5, 7 = 2
	TH  as Throttle;               # 6, 7 = 1
	
	CONNECTIONS # BO -> TU -> CO -> TH -> BO
	BO.Out	to	TU.In;
	TU.Out	to  CO.In;
	CO.Out	to  PU.In;
	PU.Out	to  TH.In;
	TH.In	to	BO.In;
	
	SPECIFY
	# Steam source
	"Boiler mdot"
	BO.In.mdot = 1 * "kg/s";
	"Boiler T_in"
	BO.In.T = 300 * "K";
	"Boiler p_in"
	BO.In.p = 2 * "atm";
	
	# Boiler
	"BO p_out"
	BO.Out.p = 11.3 * "MPa";
	"BO T_out"
	BO.Out.T = (530 + 273.15) * "K";
	#GV.q = 230; # MJ/s

	# Turbine
	#Turb.Pot = 63 * "1000*kW";
	"TU efficiency"
	TU.eta = 0.8;
	"TU p_out"
	TU.Out.p = 0.007 * "MPa";
	
	# Condenser
	"CO T_out"
	CO.Out.T = 300 * "K";
	"CO p_out"
	CO.Out.p = TU.Out.p;

	# Pump
	"PU p_out"
	PU.Out.p = 1 * "MPa";
	#P.p = 0.9 * "1000*kW";
	"PU efficiency"
	PU.eta = 0.7;
	
	GUESS
	#Cond.Out.h = 300 * "kJ/kg";
	#Cond.Out.P = 1 * "atm";

	OPTIONS
	mode = "steady";
	outputLevel = "all";
end
