%define pyver %(python -c 'import sys ; print sys.version[:3]')
%define ASCEND_MODELS %(ascend-config --models)

Name:		freesteam
Summary:	Steam tables library (implements IAPWS-IF97 and IAPWS-95 correlations)
Version:	@VERSION@

# Use release 0.* so that other users can do patch releases with a higher number
# and still have the update occur automatically.
Release:	0%{?dist}

License:	GPL
Group:		Applications/Engineering
Source:		%{name}-%{version}.tar.bz2
URL:		http://pye.dyndns.org/freesteam/

Prefix:		%{_prefix}
Packager:	John Pye
Vendor:		John Pye
BuildRoot:	%{_tmppath}/%{name}-%{version}-root

BuildRequires: python >= 2.4, python-devel
BuildRequires: scons >= 0.96.1
BuildRequires: swig >= 1.3.24
BuildRequires: blas, ascend-devel >= 0.9.5.100
BuildRequires: gcc-c++

%description
freesteam is an open source implementation of international-standard steam tables 
from the International Association for the Properties of Water and Steam (IAPWS). 
See http://freesteam.sf.net for more information.

#----------------------------------
%if %{defined freesteam_split}
%package ascend
Summary: freesteam external library for use with ASCEND
Group: Applications/Engineering
Requires: %{name}-%{version}
Requires: ascend
%description ascend
ASCEND bindings for the freesteam steam tables library. This package allows
IAPWS-IF97 steam tables to be used in ASCEND for modelling of water/steam
equipment models.

%package python
Summary: freesteam external library for use with Python
Group: Applications/Engineering
Requires: %{name}-%{version}
Requires: python-{pyver}
%description python
Python bindings for the freesteam steam tables library. This package allows
IAPWS-IF97 steam tables to be calculated using the Python scripting language.
%endif

%package devel
Summary: Developer files for freesteam
Group: Applications/Engineering
Requires: %{name}-%{version}
%description devel
Developer files for the freesteam IAPWS steam properties library, including
C++ header files and shared library symlinks.
#-----------------------------------

%prep
%setup -q 

%build
rm -rf %{buildroot}
mkdir -p %{buildroot}%{_prefix}
mkdir -p %{buildroot}%{_libdir}
mkdir -p %{buildroot}%{_includedir}
mkdir -p %{buildroot}%{_includedir}
mkdir -p %{buildroot}%{_datadir}
mkdir -p %{buildroot}%{ASCEND_MODELS}
scons %{?_smp_mflags} \
		SONAME=@SONAME@ \
		SONAME_MINOR=@SONAME_MINOR@ \
		CXX="%{?ccache} g++" \
	ascend python

%install
scons %{?_smp_mflags} \
		SONAME=@SONAME@ \
		SONAME_MINOR=@SONAME_MINOR@ \
		INSTALL_ROOT=%{buildroot} \
		INSTALL_PREFIX=%{_prefix} \
		INSTALL_SHARE=%{_datadir} \
	install

# Fix uninstalled files
mkdir -p %{buildroot}%{_libdir}/python%{pyver}/site-packages/
cp python/freesteam.py %{buildroot}%{_libdir}/python%{pyver}/site-packages/
cp python/_freesteam.so %{buildroot}%{_libdir}/python%{pyver}/site-packages/

mkdir -p %{buildroot}%{ASCEND_MODELS}
cp ascend/testfreesteam.a4c %{buildroot}%{ASCEND_MODELS}
cp ascend/libfreesteam.so %{buildroot}%{ASCEND_MODELS}

%clean
rm -rf %{buildroot} 

%post
/sbin/ldconfig

%postun
/sbin/ldconfig

%files
%defattr(-, root, root)
%doc README.html INSTALL.html LICENSE.txt
%{_libdir}/@SONAME@@SONAME_MINOR@

#----------------------------
%if %{defined freesteam_split}
%files ascend
%defattr(-, root, root)
%endif
%{ASCEND_MODELS}/libfreesteam.so
%{ASCEND_MODELS}/testfreesteam.a4c

%if %{defined freesteam_split}
%files python
%defattr(-, root, root)
%endif
%{_libdir}/python%{pyver}/site-packages/freesteam.py*
%{_libdir}/python%{pyver}/site-packages/_freesteam.so

%if %{defined freesteam_split}
%files devel
%defattr(-, root, root)
%endif
%{_includedir}/%{name}/*.h
%{_libdir}/@SHLIBPREFIX@%{name}@SHLIBSUFFIX@
%{_libdir}/@SONAME@

#-----------------------------

%changelog
* Wed May 30 2007 John Pye <john@curioussymbols.com> 0.7.2
- Updated for 0.7.2
- Split ASCEND and Python parts into sub-packages.

* Wed Oct 25 2006 John Pye <john.pye@student.unsw.edu.au> 0.6.1
- Added to sf.net CVS repository, updating for use with scons

* Wed Sep 27 2006 Christophe Trophime <christophe.trophime@grenoble.cnrs.fr>
- Initial build for fc5

